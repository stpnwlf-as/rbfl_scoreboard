<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>RBFL Board</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: transparent; font-family: 'Segoe UI', sans-serif; text-transform: uppercase; color: white; }
        
        /* ФОН ТРАНСЛЯЦИИ (Оверлей) */
        #overlay {
            position: fixed; top: 0; left: 0; width: 1920px; height: 1080px;
            background-size: cover; background-position: center;
            z-index: 9999; display: none;
        }

        /* ТАБЛО */
        .sc-container { position: absolute; top: 40px; left: 40px; display: flex; height: 90px; background: rgba(20,20,20,0.95); border-bottom: 4px solid #1e7b4d; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .team-box { display: flex; align-items: center; min-width: 200px; padding: 0 20px; font-size: 26px; font-weight: 800; }
        .score-box { background: #1e7b4d; display: flex; align-items: center; justify-content: center; min-width: 110px; font-size: 52px; font-weight: 900; }
        .logo-box { background: white; width: 120px; display: flex; align-items: center; justify-content: center; border-left: 3px solid #333; }
        .logo-box img { max-height: 85%; max-width: 85%; }
        .info-box { background: #000; min-width: 130px; display: flex; flex-direction: column; justify-content: center; text-align: center; border-left: 2px solid #333; }
        .timer { font-size: 30px; font-weight: 800; }
        .half { font-size: 14px; color: #1e7b4d; font-weight: 900; }
    </style>
</head>
<body>

    <div id="overlay"></div>

    <div class="sc-container">
        <div class="team-box" style="text-align:right; justify-content: flex-end;" id="nameH">HOME</div>
        <div class="score-box"><span id="scH">0</span>:<span id="scA">0</span></div>
        <div class="team-box" id="nameA">AWAY</div>
        <div class="logo-box"><img src="Logo.jpg"></div>
        <div class="info-box">
            <div class="timer" id="time">00:00</div>
            <div class="half"><span id="per">1</span> ТАЙМ</div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyClxwTPMqybIpYEllgyL6_H5an_1N05kzM",
            authDomain: "scoreboard-6f187.firebaseapp.com",
            databaseURL: "https://scoreboard-6f187-default-rtdb.firebaseio.com",
            projectId: "scoreboard-6f187",
            storageBucket: "scoreboard-6f187.firebasestorage.app",
            messagingSenderId: "357357389212",
            appId: "1:357357389212:web:c1f13292a9ec0745afb459"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Получаем номер поля из ссылки ?f=1
        const urlParams = new URLSearchParams(window.location.search);
        const fieldNum = urlParams.get('f') || 1;

        db.ref('fields/f' + fieldNum).on('value', snap => {
            const data = snap.val();
            if(!data) return;

            document.getElementById('nameH').innerText = data.homeName || "HOME";
            document.getElementById('nameA').innerText = data.awayName || "AWAY";
            document.getElementById('scH').innerText = data.homeScore || 0;
            document.getElementById('scA').innerText = data.awayScore || 0;
            document.getElementById('per').innerText = data.period || 1;

            // Оверлей (Фон трансляции)
            const ov = document.getElementById('overlay');
            if (data.showOverlay && data.overlayUrl) {
                ov.style.backgroundImage = `url('${data.overlayUrl}')`;
                ov.style.display = 'block';
            } else {
                ov.style.display = 'none';
            }
        });

        // Автономный таймер (тикает сам)
        setInterval(() => {
            db.ref('fields/f' + fieldNum + '/timer').once('value', snap => {
                const t = snap.val();
                if (!t) return;
                let rem = t.remainingAtStart;
                if (t.isRunning) {
                    const elapsed = Math.floor((Date.now() - t.lastUpdate) / 1000);
                    rem = Math.max(0, t.remainingAtStart - elapsed);
                }
                const m = Math.floor(rem / 60);
                const s = rem % 60;
                document.getElementById('time').innerText = (m<10?'0'+m:m)+':'+(s<10?'0'+s:s);
            });
        }, 1000);
    </script>
</body>
</html>
